<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ชำระผ่าน QR</title>

<style>
body{font-family:Arial;background:#f6f6f6;padding:20px}
.box{background:#fff;max-width:420px;margin:auto;padding:20px;border-radius:12px}
.qr img{width:220px;border:1px solid #ccc;border-radius:8px}
button{width:100%;padding:12px;border:none;border-radius:8px;margin-top:10px;font-size:16px}
.ok{background:#4CAF50;color:#fff}
.back{background:#ccc}
</style>
</head>

<body>

<div class="box">
<h2 align="center">QR Code ชำระเงิน</h2>

<p align="center">
ยอดที่ต้องชำระ:
<b id="totalPrice">0.00</b> บาท
</p>

<div class="qr" align="center">
<img src="https://promptpay.io/0902351343">
<p>สแกนเพื่อชำระเงิน</p>
</div>

<label>แนบสลิป</label>
<input type="file" accept="image/*" onchange="upload(this)">
<div id="preview"></div>

<button class="ok" onclick="confirmPay()">ยืนยัน</button>
<button class="back" onclick="location.href='index3.html'">ย้อนกลับ</button>
</div>

<script>
if(!localStorage.getItem("customerName")){
  location.href="index3.html";
}

document.getElementById("totalPrice").innerText =
  Number(localStorage.getItem("totalPrice")||0).toFixed(2);

let slip=null;
function upload(i){
  const r=new FileReader();
  r.onload=e=>{
    slip=e.target.result;
    preview.innerHTML=`<img src="${slip}" style="width:100%">`;
  };
  r.readAsDataURL(i.files[0]);
}

function confirmPay(){
  if(!slip){alert("แนบสลิปก่อน");return;}

  const order={
    name:localStorage.getItem("customerName"),
    phone:localStorage.getItem("customerPhone"),
    address:localStorage.getItem("customerAddress"),
    total:localStorage.getItem("totalPrice"),
    payment:"QR Code",
    status:"ชำระเงินแล้ว",
    slip:slip,
    date:new Date().toLocaleString("th-TH")
  };

  localStorage.setItem("orderInfo",JSON.stringify(order));
  location.href="index7.html";
}
</script>

</body>
</html>